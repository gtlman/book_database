# <center>事务</center>
## <center>原理</center>
是数据库并发控制的基本单位，也可以看作是一组SQL命令，要么全部成功，要么全部失败。


## <center>目的</center>
1. 提供从失败恢复到正常状态的方法
2. 为并发访问数据库时互相干扰的操作提供隔离


## <center>特性</center>
A->atomicity原子性：事务是一个最小不可分原子->整体要么全部成功，要么全部失败

C->consistency一致性：事务执行前后，系统数据保持正确->违背约束的事务不会被执行

I->isolation隔离性：允许数据库并发接收多个事务->考虑到效率问题，提出了四个隔离接别

D->duration持久性：事务的修改是永久的->事务执行之后，数据是永久性修改


## <center>四个隔离级别</center>
读未提交：其它事务可以读到当前事务还未提交的改变（隔离级别最低）

读已提交：其它事务只能读到当前事务已提交的改变

可重复读：一个事务内先后查询的结果是一样的->通过读数据后加锁实现，例如：

`SELECT * FROM XXX FOR UPDATE    #加悲观锁，明确读完之后要update操作`

串行化：多个事务串行执行，隔离级别最低，但是效率较低（Redis）

## <center>并发控制</center>
脏读dirty read：能读到另一个事务还未提交的修改

幻读phantom read：一个事务内的两次查询，第一次没结果，第二次有结果。

非重复读nonrepeatable read：一个事务内的两次查询，结果不同。

丢失修改lost update：并发事务写入，因为覆盖造成的修改的丢失。


## <center>使用事务</center>
因为 MySQL 默认是自动提交的，因此可以设置取消自动提交，也可以通过方法一主动启用事务
### 方法一
```
BEGIN       # 开启事务
ROLLBACK    # 回滚事务
COMMIT      # 提交事务
```

### 方法二
设置取消自动提交
```
SET AUTOCOMMIT=0
```
